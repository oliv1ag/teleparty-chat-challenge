{
  "version": 3,
  "sources": ["../../../../teleparty-websocket-lib/lib/SocketMessageTypes.js", "../../../../teleparty-websocket-lib/lib/SocketCallbackManager.js", "../../../../teleparty-websocket-lib/lib/TelepartyClient.js", "../../../../teleparty-websocket-lib/lib/index.js"],
  "sourcesContent": ["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SocketMessageTypes = void 0;\nvar SocketMessageTypes;\n(function (SocketMessageTypes) {\n    SocketMessageTypes[\"CREATE_SESSION\"] = \"createSession\";\n    SocketMessageTypes[\"JOIN_SESSION\"] = \"joinSession\";\n    SocketMessageTypes[\"SEND_MESSAGE\"] = \"sendMessage\";\n    SocketMessageTypes[\"SET_TYPING_PRESENCE\"] = \"setTypingPresence\";\n})(SocketMessageTypes = exports.SocketMessageTypes || (exports.SocketMessageTypes = {}));\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SocketCallbackManager = void 0;\nclass SocketCallbackManager {\n    constructor() {\n        this._callbackMap = new Map();\n    }\n    makeId() {\n        let result = '';\n        const hexChars = '0123456789abcdef';\n        for (let i = 0; i < 16; i += 1) {\n            result += hexChars[Math.floor(Math.random() * 16)];\n        }\n        return result;\n    }\n    executeCallback(callbackId, data) {\n        const callback = this._callbackMap.get(callbackId);\n        if (callback) {\n            callback(data);\n            this._callbackMap.delete(callbackId);\n        }\n    }\n    addCallback(callback) {\n        let newId = this.makeId();\n        while (this._callbackMap.has(newId)) {\n            newId = this.makeId();\n        }\n        this._callbackMap.set(newId, callback);\n        return newId;\n    }\n}\nexports.SocketCallbackManager = SocketCallbackManager;\n", "\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TelepartyClient = void 0;\nconst SocketCallbackManager_1 = require(\"./SocketCallbackManager\");\nconst SocketMessageTypes_1 = require(\"./SocketMessageTypes\");\nconst SOCKET_URL = \"wss://uwstest.teleparty.com\";\nconst MAX_RECONNECT_ATTEMPTS = 10;\nconst RECONNECT_INTERVAL = 1000;\nconst RECONNECT_DECAY = 2;\nconst MANUAL_CLOSE_CODE = 4500;\nclass TelepartyClient {\n    constructor(eventHandler) {\n        this._socketEventHandler = eventHandler;\n        this._socket = new WebSocket(SOCKET_URL);\n        this._callbackManager = new SocketCallbackManager_1.SocketCallbackManager();\n        this._handleSocketEvents();\n        this._reconnectAttempts = 0;\n    }\n    _handleSocketEvents() {\n        this._socket.onmessage = this._onMessage.bind(this);\n        this._socket.onclose = this._onClose.bind(this);\n        this._socket.onerror = this._onError.bind(this);\n        this._socket.onopen = this._onOpen.bind(this);\n    }\n    _onMessage(event) {\n        try {\n            const message = JSON.parse(event.data);\n            if (message.callbackId) {\n                this._callbackManager.executeCallback(message.callbackId, message.data);\n            }\n            else {\n                this._socketEventHandler.onMessage(message);\n            }\n        }\n        catch (error) {\n            //\n        }\n    }\n    _onOpen() {\n        this._socketEventHandler.onConnectionReady();\n    }\n    _onClose(event) {\n        this._socketEventHandler.onClose();\n    }\n    _onError(event) {\n        this._socket.close();\n    }\n    _formatMessage(type, data, callbackId) {\n        return {\n            type: type,\n            data: data,\n            callbackId: callbackId\n        };\n    }\n    /**\n     * Join a room with a given id\n     * @param nickname The name of the user in chat\n     * @param userIcon The users icon in chat (Optional)\n     * @param roomId\n     * @returns{MessageList} The list of previous messages in the session\n     */\n    joinChatRoom(nickname, roomId, userIcon) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const joinData = {\n                videoId: \"0\",\n                sessionId: roomId,\n                videoService: \"netflix\",\n                permId: \"0000000000000000\",\n                userSettings: {\n                    userIcon: userIcon,\n                    userNickname: nickname\n                }\n            };\n            const sessionData = yield new Promise((resolve) => {\n                this.sendMessage(SocketMessageTypes_1.SocketMessageTypes.JOIN_SESSION, joinData, (res) => {\n                    resolve(res);\n                });\n            });\n            if (sessionData.errorMessage) {\n                throw new Error(sessionData.errorMessage);\n            }\n            return {\n                messages: sessionData.messages\n            };\n        });\n    }\n    /**\n     * Create a chat room\n     * @param nickname The name of the user in chat\n     * @param userIcon The users icon in chat (Optional)\n     * @returns {string} The id for the created room\n     */\n    createChatRoom(nickname, userIcon) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const createData = {\n                controlLock: false,\n                videoId: \"0\",\n                videoDuration: 0,\n                videoService: \"netflix\",\n                permId: \"0000000000000000\",\n                userSettings: {\n                    userIcon: userIcon,\n                    userNickname: nickname\n                }\n            };\n            const sessionData = yield new Promise((resolve) => {\n                this.sendMessage(SocketMessageTypes_1.SocketMessageTypes.CREATE_SESSION, createData, (res) => {\n                    resolve(res);\n                });\n            });\n            if (sessionData.errorMessage) {\n                throw new Error(sessionData.errorMessage);\n            }\n            return sessionData.sessionId;\n        });\n    }\n    /**\n     * Send a message to the server over the Socket\n     * @param type Type of message to send, see \"SocketMessageTypes\"\n     * @param data\n     * @param callback Optional Callback function, will return the response from the server\n     */\n    sendMessage(type, data, callback) {\n        if (this._socket.readyState == 1) {\n            let callbackId = \"null\";\n            if (callback) {\n                callbackId = this._callbackManager.addCallback(callback);\n            }\n            const socketMessage = this._formatMessage(type, data, callbackId);\n            this._socket.send(JSON.stringify(socketMessage));\n        }\n        else {\n            if (callback) {\n                callback({\n                    errorMessage: \"Connection isn't Ready yet.\"\n                });\n            }\n        }\n    }\n    /**\n     * Close the underlying websocket connectoin\n     */\n    teardown() {\n        try {\n            this._socket.close(MANUAL_CLOSE_CODE);\n        }\n        catch (e) {\n        }\n        if (this._reconnectTimeOut) {\n            clearTimeout(this._reconnectTimeOut);\n        }\n        if (this._keepAliveInterval) {\n            clearInterval(this._keepAliveInterval);\n        }\n    }\n}\nexports.TelepartyClient = TelepartyClient;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TelepartyClient = exports.SocketMessageTypes = void 0;\nconst SocketMessageTypes_1 = require(\"./SocketMessageTypes\");\nObject.defineProperty(exports, \"SocketMessageTypes\", { enumerable: true, get: function () { return SocketMessageTypes_1.SocketMessageTypes; } });\nconst TelepartyClient_1 = require(\"./TelepartyClient\");\nObject.defineProperty(exports, \"TelepartyClient\", { enumerable: true, get: function () { return TelepartyClient_1.TelepartyClient; } });\n"],
  "mappings": "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",
  "names": ["SocketMessageTypes"]
}
